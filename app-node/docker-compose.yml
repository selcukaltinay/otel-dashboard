version: '3.8'

services:
  # OpenTelemetry Collector (Agent Mode)
  otel-collector:
    image: otel/opentelemetry-collector:latest
    container_name: otel-collector-agent
    command: ["--config=/etc/otel-collector-config.yaml"]
    volumes:
      - ./configs/otel-collector/config.yaml:/etc/otel-collector-config.yaml
    ports:
      - "14317:4317"   # OTLP gRPC receiver (farkl覺 port)
      - "14318:4318"   # OTLP HTTP receiver (farkl覺 port)
      - "18888:8888"   # Prometheus metrics exposed by the collector (farkl覺 port)
      - "13134:13133" # health_check extension (farkl覺 port)
    environment:
      - MONITORING_NODE_HOST=${MONITORING_NODE_HOST:-otel-collector-gateway}
      - NODE_NAME=${NODE_NAME:-node-01}
    networks:
      - otel-network
    restart: unless-stopped

networks:
  otel-network:
    external: true
    name: monitoring-node_otel-network
